{"componentChunkName":"component---src-templates-blog-post-blog-post-jsx","path":"/2021/09/docker-django-mysql-setup","result":{"data":{"markdownRemark":{"html":"<p><strong>TLDR:</strong> <em>Recently, a friend of mine was working on a project which was a Django website running inside a Docker container. She wanted to connect her ORM to a MySQL database, but was struggling to find out how to do this. I decided that this couldn't be too difficult to do, so I gave it a go and now I'm sharing my findings.</em></p>\n<h1>Running an example project first</h1>\n<p>In this first section, I will walk you through how you can get a running example working on your local machine. You will clone a repo I have prepared and run through the steps to get it working locally, then I will go through how I created this example.</p>\n<p>Check out the repo <a href=\"https://github.com/JamesDHW/blog-docker-django-mysql\">here</a></p>\n<h2>Clone my repo</h2>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">cd user/Github # (or wherever)\ngit clone https://github.com/JamesDHW/blog-docker-django-mysql.git\ncd docker-django-mysql</code>\n        </deckgo-highlight-code>\n<br>\n<h2>Build and run the container</h2>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">docker-compose build # build the container\ndocker-compose up -d # run the container as a daemon</code>\n        </deckgo-highlight-code>\n<br>\n<p>Go to <code class=\"language-text\">localhost:8000</code> and you should now see a basic Django page running. That's it - everything should be connected and ready for development! Just to be sure, let's do some checks to see that everything is doing what we expect.</p>\n<p>There are two services - <code class=\"language-text\">web</code> (where Django runs) and <code class=\"language-text\">db</code> (where MySQL runs) - which we will run a bash for each service and have a look at what's going on for each one.</p>\n<h2>Checking it works: Run the <code class=\"language-text\">web</code> service</h2>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\"># open a bash for the web container\ndocker-compose exec web bash\n\nping db # ping the db service.</code>\n        </deckgo-highlight-code>\n<br>\n<p>Expected output:</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">...\n64 bytes from docker-django-mysql_db_1.docker-django-mysql_default (172.22.0.2): icmp_seq=27 ttl=64 time=0.220 ms\n64 bytes from docker-django-mysql_db_1.docker-django-mysql_default (172.22.0.2): icmp_seq=28 ttl=64 time=0.451 ms\n...</code>\n        </deckgo-highlight-code>\n<br>\n<p>This shows that your <code class=\"language-text\">web</code> service can talk to your <code class=\"language-text\">db</code> service. You can also run:</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">ps aux | grep mysql</code>\n        </deckgo-highlight-code>\n<br>\n<p>to get any process that's running which contains <code class=\"language-text\">mysql</code> in the name - if you get output, a proccess has been found.</p>\n<p>Quit the bash shell for <code class=\"language-text\">web</code> with <code class=\"language-text\">cntrl+d</code>.</p>\n<h2>Checking it works: Run the <code class=\"language-text\">db</code> service</h2>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\"># open a bash for the `db` container\ndocker-compose exec db bash\n\n# (where `root` is username and `my-app-db` is the databse name)\nmysql -u root -p my-app-db </code>\n        </deckgo-highlight-code>\n<br>\n<p>type in your password (<code class=\"language-text\">password</code>).</p>\n<p>You should now be connected to the mysql client for your database.</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\"># view all the tables (should be none)\nSHOW TABLES \n\n# create a table (you can press enter, the command is only executed after a `;`)\nCREATE TABLE users ( firstName varchar(255) ); \n\n# see the table you created\nSHOW TABLES </code>\n        </deckgo-highlight-code>\n<br>\n<p>Quit the bash shell for <code class=\"language-text\">db</code> with <code class=\"language-text\">cntrl+d</code>.</p>\n<p>If you've followed until now, you should have a working example of a Django app, running in Docker and connected to a MySQL database. Read on for more details on how I created this repo and the steps you'll need to take to replicate it in your own project.</p>\n<h1>How I made this project</h1>\n<p>Now that we know this is working, let's see how I made the project from scratch!</p>\n<deckgo-highlight-code language=\"bash\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\"># make new git repo\nmkdir DockerMySQL\ncd DockerMySQL\ngit init\ngit remote add origin ... \n\n# django init new project\npython -m django startproject DockerMySQL </code>\n        </deckgo-highlight-code>\n<br>\n<h2>Add a <code class=\"language-text\">Dockerfile</code></h2>\n<p>In the root of the project I added a Dockerfile to define the dependencies (etc.) for the container I want.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">FROM python:3.6\nENV PYTHONUNBUFFERED 1\n\nRUN pip install --upgrade pip\n\nCOPY ./requirements.txt /requirements.txt\nRUN pip install -r /requirements.txt\n\nRUN mkdir /DockerMySQL\nWORKDIR /DockerMySQL\nCOPY ./DockerMySQL /DockerMySQL</code>\n        </deckgo-highlight-code>\n<br>\n<h2>Add a <code class=\"language-text\">docker-compose.yml</code></h2>\n<p>I then created a <code class=\"language-text\">docker-compose.yml</code> to define two services, one to run the database on (called <code class=\"language-text\">db</code>) and one to run the Django site on (called <code class=\"language-text\">web</code>).</p>\n<deckgo-highlight-code language=\"yaml\" terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">version: &#39;3&#39;\n\nservices:\n  db:\n    image: mysql:5.7\n    ports:\n      - &#39;3306:3306&#39;\n    environment:\n       MYSQL_DATABASE: &#39;my-app-db&#39;\n       MYSQL_ROOT_PASSWORD: &#39;password&#39;\n  web:\n    build: .\n    command: python manage.py runserver 0.0.0.0:8000\n    volumes:\n      - ./DockerMySQL:/DockerMySQL\n    ports:\n      - &quot;8000:8000&quot;\n    depends_on:\n      - db\n</code>\n        </deckgo-highlight-code>\n<br>\n<h2>Add a <code class=\"language-text\">requirements.txt</code></h2>\n<p>I now actually define what the requierments  for the Django app will be in <code class=\"language-text\">requirements.txt</code>.</p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">Django==1.11.5\nmysqlclient==1.3.12\ndjango-mysql==2.2.0</code>\n        </deckgo-highlight-code>\n<br>\n<h2>In <code class=\"language-text\">settings.py</code> add <code class=\"language-text\">DATABASES</code> variable</h2>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">DATABASES = {\n    &#39;default&#39;: {\n        &#39;ENGINE&#39;: &#39;django.db.backends.mysql&#39;,\n        &#39;NAME&#39;: &#39;my-app-db&#39;,\n        &#39;USER&#39;: &#39;root&#39;,\n        &#39;PASSWORD&#39;: &#39;password&#39;,\n        &#39;HOST&#39;: &#39;192.168.1.97&#39;, &lt;-- I think this might be wrong now but if it works ü§∑‚Äç‚ôÇÔ∏è\n        &#39;PORT&#39;: 3306,\n    }\n}</code>\n        </deckgo-highlight-code>\n<br>\n<h2>Remove the default <code class=\"language-text\">DATABASES</code> variable</h2>\n<p><a href=\"https://github.com/JamesDHW/docker-django-mysql/commit/89ede0086036726c9798a8c01b1093e2452e89d3\">View the commit here</a></p>\n<deckgo-highlight-code  terminal=\"carbon\" theme=\"material\" line-numbers=\"true\"  >\n          <code slot=\"code\">DATABASES = {\n    &#39;default&#39;: {\n        &#39;ENGINE&#39;: &#39;django.db.backends.sqlite3&#39;,\n        &#39;NAME&#39;: os.path.join(BASE_DIR, &#39;db.sqlite3&#39;),\n    }\n}</code>\n        </deckgo-highlight-code>\n<br>","frontmatter":{"date":"September 19, 2021","slug":"2021/09/docker-django-mysql-setup","title":"How to connect your MySQL Database to your Dockerized Django site","thumbnail":{"childImageSharp":{"gatsbyImageData":{"layout":"constrained","placeholder":{"fallback":"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAFCAYAAABFA8wzAAAACXBIWXMAAAsTAAALEwEAmpwYAAABoElEQVQY0wGVAWr+AB6WvQEobnwAfQUBAyyUvQUnjLAAEW6GACA5JwD///8AlaWeAF51bABieXAAZ3x0AH6QiQAjRTkASXyPATWBsQEAXf8AVIOSElaEkA81fq0AAB6JrAAvZnFKK3SHwjVSVC4nm8cuFFFXJwYrHKJsgXmwKkk9rRA0Jq4VOCuuFTgqrBY5LLkMMCN8JFBSAEWh7QCFjGgAAG3/DBZ5xx0zfq8KACR0jk4bhqj/IIqr/x6JqtsmjbOqAz9ESlFpXvqyvLn/nqym/4eZkv+Nnpj/mqij/5Ghm/86V0u+DG2pEzqBrDbEljMb+J8FMOCbGjNrh38YACV2kjFNor/dIZa/9BOHr8U8ia4TAAAAFxw/MupXb2b4WXJo9ChIPPVKZVv1hpeQ8TRSR/8YOSupT5O9MDh+qGyJjWZL/6IAVP2gAVz/ogAUABZ5mwD/6IoHPWh0GBbc/wAcbYUAHlxhBgAUAyMADAAnAAAAJgAAACcAJRYnGDotJgAAACkAIRMaFEpUADVeXAEaesYDHXzBAOecEwTZlx8CgRiVMBqhXKQAAAAASUVORK5CYII="},"images":{"fallback":{"src":"/blog/static/0e7034a06a9601d5937e6d771517cef8/821da/thumbnail.png","srcSet":"/blog/static/0e7034a06a9601d5937e6d771517cef8/22719/thumbnail.png 185w,\n/blog/static/0e7034a06a9601d5937e6d771517cef8/b91c6/thumbnail.png 370w,\n/blog/static/0e7034a06a9601d5937e6d771517cef8/821da/thumbnail.png 740w","sizes":"(min-width: 740px) 740px, 100vw"},"sources":[{"srcSet":"/blog/static/0e7034a06a9601d5937e6d771517cef8/6b17e/thumbnail.avif 185w,\n/blog/static/0e7034a06a9601d5937e6d771517cef8/097b8/thumbnail.avif 370w,\n/blog/static/0e7034a06a9601d5937e6d771517cef8/3950a/thumbnail.avif 740w","type":"image/avif","sizes":"(min-width: 740px) 740px, 100vw"},{"srcSet":"/blog/static/0e7034a06a9601d5937e6d771517cef8/4d5e6/thumbnail.webp 185w,\n/blog/static/0e7034a06a9601d5937e6d771517cef8/bb639/thumbnail.webp 370w,\n/blog/static/0e7034a06a9601d5937e6d771517cef8/4baf0/thumbnail.webp 740w","type":"image/webp","sizes":"(min-width: 740px) 740px, 100vw"}]},"width":800,"height":196.75675675675677}}}}}},"pageContext":{"slug":"2021/09/docker-django-mysql-setup"}},"staticQueryHashes":[]}